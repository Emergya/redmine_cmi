<div id="tab-content-metrics">
<h2><%=l('cmi.label_metrics')%></h2>

<% remote_form_for(:project, @project, :url => {:controller => 'metrics', :action => 'show', :project_id => @project, :metrics => 'all'}, :method => :post) do |f| %>
    <p class="other-formats"><%= submit_tag l('cmi.label_view_all') %></p>
<% end %>
<table class="list issues" border="1">
  <thead>
    <tr>
      <th rowspan="1" width="150"><%=l('cmi.label_area')%></th>
      <th rowspan="2" width="150"><%=l(:label_environment)%></th>
      <th colspan="2" width="150"><%=l('cmi.label_metric')%></th>
      <% @names.each do |report| %>
        <th colspan="1"><% if(report=="actual")%>Valor actual - <%end%><%= get_report_value(report, 'Fecha del informe') %></th>
      <% end %>
    </tr>
  </thead>
  <tr>
    <th rowspan=65><%= l('cmi.label_project_management') %></th>
    <th rowspan=21><%= l('cmi.label_effort') %></th>
     <th rowspan="7"><%= l('cmi.label_done') %></th>
     <td><%= l('cmi.label_JP') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_jp') %></td>
        <% set_value('jp', report, 'effort_done', 'effort_done_jp') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AF') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_af') %></td>
        <% set_value('af', report, 'effort_done', 'effort_done_af') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AP') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_ap') %></td>
        <% set_value('ap', report, 'effort_done', 'effort_done_ap') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PS') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_ps') %></td>
        <% set_value('ps', report, 'effort_done', 'effort_done_ps') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PJ') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_pj') %></td>
        <% set_value('pj', report, 'effort_done', 'effort_done_pj') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_B') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_done_b') %></td>
        <% set_value('b', report, 'effort_done', 'effort_done_b') %>
     <% end %>
  </tr>

  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
        <%effort_done_act = get_report_value(report, 'effort_real', 'effort_done')%>
        <td class="issue">
          <%= get_report_value(report, 'effort_done') %> <%= l('cmi.label_hours') %>
          <img src="http://chart.apis.google.com/chart?cht=p3&chd=t:<%=instance_variable_get("@value_jp_#{report}")%>,<%=instance_variable_get("@value_af_#{report}")%>,<%=instance_variable_get("@value_ap_#{report}")%>,<%=instance_variable_get("@value_ps_#{report}")%>,<%=instance_variable_get("@value_pj_#{report}")%>,<%=instance_variable_get("@value_b_#{report}")%>&chs=220x50&chl=JP: <%=instance_variable_get("@value_jp_#{report}")%>%|AF: <%=instance_variable_get("@value_af_#{report}")%>%|AP: <%=instance_variable_get("@value_ap_#{report}")%>%|PS: <%=instance_variable_get("@value_ps_#{report}")%>%|PJ: <%=instance_variable_get("@value_pj_#{report}")%>%|B: <%=instance_variable_get("@value_b_#{report}")%>%"/>
        </td>
     <% end %>
  </tr>

  <tr>
    <th rowspan=7><%= l('cmi.label_remaining') %></th>
    <td><%= l('cmi.label_JP') %></td
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_jp') %></td>
        <% set_value('jp', report, 'effort_remaining', 'effort_remaining_jp') %>
    <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AF') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_af') %></td>
        <% set_value('af', report, 'effort_remaining', 'effort_remaining_af') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AP') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_ap') %></td>
        <% set_value('ap', report, 'effort_remaining', 'effort_remaining_ap') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PS') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_ps') %></td>
        <% set_value('ps', report, 'effort_remaining', 'effort_remaining_ps') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PJ') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_pj') %></td>
        <% set_value('pj', report, 'effort_remaining', 'effort_remaining_pj') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_B') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'effort_remaining_b') %></td>
        <% set_value('b', report, 'effort_remaining', 'effort_remaining_b') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
      <td class="issue">
        <%= get_report_value(report, 'effort_remaining') %>
        <img src="http://chart.apis.google.com/chart?cht=p3&chd=t:<%=instance_variable_get("@value_jp_#{report}")%>,<%=instance_variable_get("@value_af_#{report}")%>,<%=instance_variable_get("@value_ap_#{report}")%>,<%=instance_variable_get("@value_ps_#{report}")%>,<%=instance_variable_get("@value_pj_#{report}")%>,<%=instance_variable_get("@value_b_#{report}")%>&chs=220x50&chl=JP: <%=instance_variable_get("@value_jp_#{report}")%>%|AF: <%=instance_variable_get("@value_af_#{report}")%>%|AP: <%=instance_variable_get("@value_ap_#{report}")%>%|PS: <%=instance_variable_get("@value_ps_#{report}")%>%|PJ: <%=instance_variable_get("@value_pj_#{report}")%>%|B: <%=instance_variable_get("@value_b_#{report}")%>%"/>
      </td>
     <% end %>
  </tr>

  <tr>
    <th rowspan=7><%= l('cmi.label_planned') %></th>
    <td><%= l('cmi.label_JP') %></td>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual JP') %> <%= l('cmi.label_hours') %></td>
        <% set_value('JP', report, 'effort_real', 'Esfuerzo actual JP') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AF') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual AF') %> <%= l('cmi.label_hours') %></td>
        <% set_value('AF', report, 'effort_real', 'Esfuerzo actual AF') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AP') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual AP') %> <%= l('cmi.label_hours') %></td>
        <% set_value('AP', report, 'effort_real', 'Esfuerzo actual AP') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PS') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual PS') %> <%= l('cmi.label_hours') %></td>
        <% set_value('PS', report, 'effort_real', 'Esfuerzo actual PS') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PJ') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual PJ') %> <%= l('cmi.label_hours') %></td>
        <% set_value('PJ', report, 'effort_real', 'Esfuerzo actual PJ') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_B') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Esfuerzo actual B') %> <%= l('cmi.label_hours') %></td>
        <% set_value('B', report, 'effort_real', 'Esfuerzo actual B') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
      <td class="issue">
        <%= get_report_value(report, 'effort_real') %>
        <img src="http://chart.apis.google.com/chart?cht=p3&chd=t:<%=instance_variable_get("@value_jp_#{report}")%>,<%=instance_variable_get("@value_af_#{report}")%>,<%=instance_variable_get("@value_ap_#{report}")%>,<%=instance_variable_get("@value_ps_#{report}")%>,<%=instance_variable_get("@value_pj_#{report}")%>,<%=instance_variable_get("@value_b_#{report}")%>&chs=220x50&chl=JP: <%=instance_variable_get("@value_jp_#{report}")%>%|AF: <%=instance_variable_get("@value_af_#{report}")%>%|AP: <%=instance_variable_get("@value_ap_#{report}")%>%|PS: <%=instance_variable_get("@value_ps_#{report}")%>%|PJ: <%=instance_variable_get("@value_pj_#{report}")%>%|B: <%=instance_variable_get("@value_b_#{report}")%>%"/>
      </td>
     <% end %>
  </tr>

  <tr>
    <th rowspan=4><%= l('cmi.label_time') %></th>
     <th rowspan="1" colspan="2"><%= l('cmi.label_done') %></th>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'time_done') %> </td>
        <% set_value('time_done', report, 'time_total_real','time_done') %>
     <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_remaining') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'time_remaining') %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_planned') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'time_total_real') %> </td>
    <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
        <td><img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%=instance_variable_get("@value_time_done_#{report}")%>|100&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x50&chxt=x,y&chxl=0:|0|50|100|1:|<%=instance_variable_get("@value_time_done_#{report}").round(2)%>% |"/></td>
    <% end %>
  </tr>

  <tr>
    <th rowspan=10><%= l('cmi.label_cost') %></th>
     <th rowspan="3"><%= l('cmi.label_done') %></th>
     <td><%= l('cmi.label_RRHH') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_spent_rrhh') %>€ </td>
        <% set_cost_value('rrhh_i', report, 'budget_real_rrhh','budget_spent_rrhh') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_others') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Gastado') %>€ </td>
        <% set_cost_value('others_i', report, 'budget_spent', 'Gastado') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_spent') %>€ </td>
        <% set_cost_value('i', report, 'budget_real', 'budget_spent') %>
     <% end %>
  </tr>
  <tr>
    <th rowspan=3><%= l('cmi.label_remaining') %></th>
    <td><%= l('cmi.label_RRHH') %></td>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_remaining_rrhh') %>€ </td>
        <% set_cost_value('rrhh_r', report, 'budget_remaining', 'budget_remaining_rrhh') %>
    <% end %>
  </tr>
  <tr>
    <td><%= l('cmi.label_others') %></td>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_remaining_rrmm_and_others') %>€ </td>
        <% set_cost_value('others_r', report, 'budget_remaining', 'budget_remaining_rrmm_and_others') %>
    <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_remaining') %>€ </td>
     <% end %>
  </tr>

  <tr>
    <th rowspan=3><%= l('cmi.label_planned') %></th>
    <td><%= l('cmi.label_RRHH') %></td>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_real_rrhh') %>€ </td>
        <% set_cost_value('rrhh_p', report, 'budget_real', 'budget_real_rrhh') %>
    <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_others') %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Presupuesto actual') %>€ </td>
        <% set_cost_value('others_p', report, 'budget_real', 'Presupuesto actual') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'budget_real') %>€ </td>
     <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%=instance_variable_get("@cost_rrhh_i_#{report}")%>,<%=instance_variable_get("@cost_others_i_#{report}")%>,<%=instance_variable_get("@cost_i_#{report}")%>|100,100,100&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|0|50|100|1:|Total: <%=instance_variable_get("@cost_i_#{report}")%>%|Otros: <%=instance_variable_get("@cost_others_i_#{report}")%>%|RRHH: <%=instance_variable_get("@cost_rrhh_i_#{report}")%>%|"/>
        <img src="http://chart.apis.google.com/chart?cht=p3&chd=t:<%=instance_variable_get("@cost_rrhh_p_#{report}")%>,<%=instance_variable_get("@cost_others_p_#{report}")%>&chs=250x50&chl=RRHH: <%=instance_variable_get("@cost_rrhh_p_#{report}")%>%|Otros: <%=instance_variable_get("@cost_others_p_#{report}")%>%|"/>
      </td>
     <% end %>
  </tr>
  <tr>
    <th rowspan=12><%= l('cmi.label_advance') %></th>
     <th rowspan="7"><%= l('cmi.label_effort_plural') %></th>
     <td><%= l('cmi.label_JP') %></td>
     <% @names.each do |report| %>
        <%value_esf_jp = get_report_value(report, 'Esfuerzo actual JP', 'effort_done_jp')%>
        <td class="issue"><%=value_esf_jp != 0.0? value_esf_jp : "--"%> % </td>
        <% set_value('esf_jp', report, 'Esfuerzo actual JP', 'effort_done_jp') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AF') %></td>
     <% @names.each do |report| %>
        <%value_esf_af = get_report_value(report, 'Esfuerzo actual AF', 'effort_done_af')%>
        <td class="issue"><%=value_esf_af != 0.0? value_esf_af : "--"%> % </td>
        <% set_value('esf_af', report, 'Esfuerzo actual AF', 'effort_done_af') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_AP') %></td>
     <% @names.each do |report| %>
        <%value_esf_ap = get_report_value(report, 'Esfuerzo actual AP', 'effort_done_ap') %>
        <td class="issue"><%=value_esf_ap != 0.0? value_esf_ap : "--"%> % </td>
        <% set_value('esf_ap', report, 'Esfuerzo actual AP', 'effort_done_ap') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PS') %></td>
     <% @names.each do |report| %>
        <%value_esf_ps = get_report_value(report, 'Esfuerzo actual PS', 'effort_done_ps') %>
        <td class="issue"><%=value_esf_ps != 0.0? value_esf_ps : "--"%> % </td>
        <% set_value('esf_ps', report, 'Esfuerzo actual PS', 'effort_done_ps') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_PJ') %></td>
     <% @names.each do |report| %>
        <%value_esf_pj = get_report_value(report, 'Esfuerzo actual PJ', 'effort_done_pj') %>
        <td class="issue"><%=value_esf_pj != 0.0? value_esf_pj : "--"%> % </td>
        <% set_value('esf_pj', report, 'Esfuerzo actual PJ', 'effort_done_pj') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_B') %></td>
     <% @names.each do |report| %>
        <%value_esf_b = get_report_value(report, 'Esfuerzo actual B', 'effort_done_b') %>
        <td class="issue"><%=value_esf_b != 0.0? value_esf_b : "--"%> % </td>
        <% set_value('esf_b', report, 'Esfuerzo actual B', 'effort_done_b') %>
     <% end %>
  </tr>
  <tr>
     <td><%= l(:label_project) %></td>
     <% @names.each do |report| %>
        <%value_esf_proyect = get_report_value(report, 'effort_real', 'effort_done') %>
        <td class="issue"><%= value_esf_proyect != 0.0? value_esf_proyect : "--"%> % </td>
        <% set_value('esf_proyect', report, 'effort_real', 'effort_done') %>
     <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_time') %></th>
    <% @names.each do |report| %>
        <%value_time = get_report_value(report, 'time_total_real', 'time_done') %>
        <td class="issue"><%= value_time != 0.0? value_time : "--" %> % </td>
        <% set_value('time', report, 'time_total_real', 'time_done') %>
    <% end %>
  </tr>

  <tr>
    <th rowspan=3><%= l('cmi.label_budgets') %></th>
    <td><%= l('cmi.label_RRHH') %></td>
    <% @names.each do |report| %>
        <%value_budget_rrhh = get_report_value(report, 'budget_real_rrhh', 'budget_spent_rrhh') %>
        <td class="issue"><%= value_budget_rrhh != 0.0? value_budget_rrhh : "--" %> %</td>
        <% set_value('budget_rrhh', report, 'budget_real_rrhh', 'budget_spent_rrhh') %>
    <% end %>
  </tr>
  <tr>
     <td><%= l('cmi.label_others') %></td>
     <% @names.each do |report| %>
        <%value_budget_others = get_report_value(report, 'Presupuesto_actual', 'Gastado') %>
        <td class="issue"><%= value_budget_others != 0.0? value_budget_others : "--" %> %</td>
        <% set_value('budget_others', report, 'Presupuesto actual', 'Gastado') %>
    <% end %>
  </tr>
  <tr>
     <td><%= l(:label_total) %></td>
     <% @names.each do |report| %>
        <%value_budget_total = get_report_value(report, 'budget_real', 'budget_spent') %>
        <td class="issue"><%= value_budget_total != 0.0? value_budget_total : "--" %> %</td>
        <% set_value('budget_total', report, 'budget_real', 'budget_spent') %>
    <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%=instance_variable_get("@value_esf_proyect_#{report}")%>,<%=instance_variable_get("@value_time_#{report}")%>,<%=instance_variable_get("@value_budget_total_#{report}")%>|100,100,100&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|0|50|100|1:|Coste: <%=instance_variable_get("@value_budget_total_#{report}")%>%|Tiempo: <%=instance_variable_get("@value_time_#{report}")%>%|Esfuerzo: <%=instance_variable_get("@value_esf_proyect_#{report}")%>%|"/>
      </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=4><%= l('cmi.label_profitability') %></th>
    <th rowspan="1" colspan="2"><%= l('cmi.label_profitability_planned') %></th>
    <% @names.each do |report| %>
       <td class="issue"><%= (get_report_value(report, 'profitability_planned'))%>€
       (<%= (get_report_value(report, 'profitability_percent_planned')).to_f.round(2) * 100 %> %) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_profitability_current') %></th>
    <% @names.each do |report| %>
       <td class="issue"><%= (get_report_value(report, 'profitability_current'))%>€
       (<%= (get_report_value(report, 'profitability_percent_current')).to_f.round(2) * 100 %> %) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_current_profit') %></th>
    <% @names.each do |report| %>
       <td class="issue"><%= (get_report_value(report, 'profitability'))%>€
       (<%= (get_report_value(report, 'profitability_percent')).to_f.round(2) * 100 %> %) </td>
    <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%=50 + (((instance_variable_get("@metrics_#{report}")['profitability_percent_planned']).to_f.round(2) * 100) * 25/50 )%>,<%= 50 + (((instance_variable_get("@metrics_#{report}")['profitability_percent_current']).to_f.round(2) * 100) * 25/50)%>,<%= 50 + (((instance_variable_get("@metrics_#{report}")['profitability_percent']).to_f.round(2) * 100) * 25/50)%>|100,100,100&chp=.5&&chxr=0,-100,100&chm=h,000000,0,0.5,0.5&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|-100|-50|0|50|100|1:|Beneficio actual:<%= (instance_variable_get("@metrics_#{report}")['profitability_percent']).to_f.round(2) * 100 %>%|Prevista actual: <%= (instance_variable_get("@metrics_#{report}")['profitability_percent_current']).to_f.round(2) * 100 %>%|Prevista inicial: <%= (instance_variable_get("@metrics_#{report}")['profitability_percent_planned']).to_f.round(2) * 100 %>%|"/>
      </td>
    <% end %>
  </tr>

  <tr>
    <th rowspan=4><%= l('cmi.label_desviation') %></th>
     <th rowspan="1" colspan="2">% <%= l('cmi.label_effort') %></th>
     <% @names.each do |report| %>
       <td class="issue"><%= instance_variable_get("@metrics_#{report}")['effort_planned'].to_f != 0.0? (((instance_variable_get("@metrics_#{report}")['effort_planned'].to_f - instance_variable_get("@metrics_#{report}")['effort_real'].to_f)/instance_variable_get("@metrics_#{report}")['effort_planned'].to_f) * 100).round(2) : "--" %> % </td>
       <% instance_variable_set("@project_effort_#{report}", (instance_variable_get("@metrics_#{report}")['effort_planned'].to_f != 0.0? (((instance_variable_get("@metrics_#{report}")['effort_planned'].to_f - instance_variable_get("@metrics_#{report}")['effort_real'].to_f)/instance_variable_get("@metrics_#{report}")['effort_planned'].to_f) * 100).round(2) : 0.0 ))%>
     <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2">% <%= l('cmi.label_time') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f != 0.0? (((instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f - instance_variable_get("@metrics_#{report}")['time_total_real'].to_f)/instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f) * 100).round(2) : "--" %> %</td>
        <% instance_variable_set("@project_time_#{report}", (instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f != 0.0? (((instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f - instance_variable_get("@metrics_#{report}")['time_total_real'].to_f)/instance_variable_get("@metrics_#{report}")['time_total_planned'].to_f) * 100).round(2) : 0.0 ))%>
     <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2">% <%= l('cmi.label_cost') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= instance_variable_get("@metrics_#{report}")['budget_planned'].to_f != 0.0 ? (((instance_variable_get("@metrics_#{report}")['budget_planned'].to_f - instance_variable_get("@metrics_#{report}")['budget_real'].to_f)/instance_variable_get("@metrics_#{report}")['budget_planned'].to_f) * 100).round(2) : "--" %>% </td>
        <% instance_variable_set("@project_cost_#{report}", (instance_variable_get("@metrics_#{report}")['budget_planned'].to_f != 0.0 ? (((instance_variable_get("@metrics_#{report}")['budget_planned'].to_f - instance_variable_get("@metrics_#{report}")['budget_real'].to_f)/instance_variable_get("@metrics_#{report}")['budget_planned'].to_f) * 100).round(2) : 0.0 ) )%>
     <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%=50 + (instance_variable_get("@project_effort_#{report}") * 25/50 )%>,<%= 50 + (instance_variable_get("@project_time_#{report}") * 25/50)%>,<%= 50 + (instance_variable_get("@project_cost_#{report}") * 25/50)%>|100,100,100&chp=.5&&chxr=0,-100,100&chm=h,000000,0,0.5,0.5&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|-100|-50|0|50|100|1:|Coste: <%= instance_variable_get("@project_cost_#{report}") %>%|Tiempo: <%= instance_variable_get("@project_time_#{report}") %>%|Esfuerzo: <%= instance_variable_get("@project_effort_#{report}") %>%|"/>
      </td>
    <% end %>
  </tr>

  <tr>
    <th rowspan=5><%= l('cmi.label_risk') %></th>
    <th rowspan="1" colspan="2"><%= l('cmi.label_risk_high') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'risk_high').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_risk_medium') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'risk_medium').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_risk_low') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'risk_low').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l(:label_total) %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= (get_report_value(report, 'risk_medium').to_f +
                               get_report_value(report, 'risk_low').to_f +
                               get_report_value(report, 'risk_high').to_f).to_i %>
        </td>
    <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%= get_report_value(report, 'risk_high').to_i  %>,<%= get_report_value(report, 'risk_medium').to_i  %>,<%= get_report_value(report, 'risk_low').to_i  %>&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|0|50|100|1:|Bajo: <%= get_report_value(report, 'risk_low').to_i  %>|Medio: <%= get_report_value(report, 'risk_medium').to_i  %>|Alto: <%= get_report_value(report, 'risk_high').to_i  %>|"/>
      </td>
    <% end %>
  </tr>

  <tr>
    <th rowspan=5><%= l('cmi.label_incidents') %></th>
    <th rowspan="1" colspan="2"><%= l('cmi.label_incidents_high') %></th>
    <% @names.each do |report| %>
      <td class="issue"><%= get_report_value(report, 'issues_high').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_incidents_medium') %></th>
    <% @names.each do |report| %>
      <td class="issue"><%= get_report_value(report, 'issues_medium').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l('cmi.label_incidents_low') %></th>
    <% @names.each do |report| %>
      <td class="issue"><%= get_report_value(report, 'issues_low').to_i  %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="2"><%= l(:label_total) %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= (get_report_value(report, 'issues_medium').to_f +
                               get_report_value(report, 'issues_low').to_f +
                               get_report_value(report, 'issues_high').to_f).to_i  %>
        </td>
    <% end %>
  </tr>
  <tr>
    <th colspan="2"><%= l('cmi.label_graphs') %></th>
    <% @names.each do |report| %>
      <td class="issue">
        <img src="http://chart.apis.google.com/chart?cht=bhs&chd=t:<%= instance_variable_get("@metrics_#{report}")['issues_high'].to_i  %>,<%= instance_variable_get("@metrics_#{report}")['issues_medium'].to_i  %>,<%= instance_variable_get("@metrics_#{report}")['issues_low'].to_i  %>&chco=4D89F9,C6D9FD&chbh=10,5,10&chs=250x70&chxt=x,y&chxl=0:|0|50|100|1:|Bajo: <%= instance_variable_get("@metrics_#{report}")['issues_low'].to_i  %>|Medio: <%= instance_variable_get("@metrics_#{report}")['issues_medium'].to_i  %>|Alto: <%= instance_variable_get("@metrics_#{report}")['issues_high'].to_i  %>|"/>
      </td>
    <% end %>
  </tr>

  <tr>
    <th rowspan=3><%= l('cmi.label_requirements_management') %></th>
    <th rowspan=2><%= l('cmi.label_changes') %></th>
    <th colspan="2"><%= l('cmi.label_accepted') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'changes_accepted').to_i %> </td>
    <% end %>
  </tr>
  <tr>
     <th colspan="2"><%= l('cmi.label_rejected') %></th>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'changes_declined').to_i %> </td>
     <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_effort_done') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'changes_effort') %> <%= l('cmi.label_hours') %>
        (<%= get_report_value(report, 'effort_done').to_f != 0.0? (get_report_value(report, 'changes_effort').to_f / get_report_value(report, 'effort_done').to_f).round(2) : "--" %>%) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=2><%= l('cmi.label_configuration_management') %></th>
    <th rowspan=1 colspan="3"><%= l('cmi.label_effort_done') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= (get_report_value(report, 'conf_effort').to_f).round(2) %> <%= l('cmi.label_hours') %>
        (<%= get_report_value(report, 'effort_done').to_f != 0.0? (get_report_value(report, 'conf_effort').to_f / get_report_value(report, 'effort_done').to_f).round(2) : "--" %>%) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_baseline_changes') %></th>
    <% @names.each do |report| %>
        <td class="issue"> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=6><%= l('cmi.label_quality_assurance') %></th>
    <th rowspan=1><%= l('cmi.label_quality_reviews') %></th>
    <th rowspan=1 colspan="2"><%= l('cmi.label_quality_reviews_done') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'Revisión calidad realizada') %>
        (<%= get_report_value(report, 'Revision calidad planificada').to_f != 0.0 ? (get_report_value(report, 'Revisión calidad realizada').to_f / get_report_value(report, 'Revision calidad planificada').to_f).round(2) : "--" %>%) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=2><%= l('cmi.label_nonconformities') %></th>
     <th colspan="2"><%= l('cmi.label_quality_reviews_detected') %></th>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'nc_total') %> </td>
     <% end %>
  </tr>
  <tr>
     <th colspan="2"><%= l('cmi.label_unresolved') %></th>
     <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'nc_open') %> </td>
     <% end %>
  </tr>

  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_no_approval_open_out_of_date') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'no_approval_open_out_of_date') %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_no_approval_open_without_date') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'no_approval_open_without_date') %> </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_ac_effort') %></th>
    <% @names.each do |report| %>
        <td class="issue"><%= get_report_value(report, 'ac_effort') %>
        (<%= get_report_value(report, 'effort_done').to_f != 0.0? (get_report_value(report, 'ac_effort').to_f / get_report_value(report, 'effort_done').to_f).round(2) : "--"%>%) </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=2><%= l('cmi.label_measurement_and_metrics') %></th>
    <th rowspan=1 colspan="3"><%= l('cmi.label_effort_annual_review') %></th>
    <% @names.each do |report| %>
      <td class="issue"> -- </td>
    <% end %>
  </tr>
  <tr>
    <th rowspan=1 colspan="3"><%= l('cmi.label_effort_reporting') %></th>
    <% @names.each do |report| %>
      <td class="issue"> -- </td>
    <% end %>
  </tr>

  </table>

  </div>